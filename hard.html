<!DOCTYPE html>
<html>
    <head>
        <link rel="Stylesheet" href="css.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
        <meta charset="utf-8">
        <title>BrawlStars-dle</title>
    </head>
    <body>

        <header id="toph">
            <img src="images/arrow.png" class="logobutton" draggable="false" onclick="hidemenu();" id="logoarr">
            <img src="images/logo.png" id="top" height="7vh" draggable="false">
            <img src="images/darkmode.png" class="logobutton" draggable="false" onclick="tdarkmode();">
        </header>
        <nav id="navmain">
            <span class="links"><a id="linkdaily" href="daily.html" class="aNav">DAILY</a></span>
            <span class="links"><a id="linknormal" href="index.html" class="aNav">NORMAL</a></span>
            <span class="links"><a id="linkhard" href="hard.html" class="aNav" style="color: white">HARD</a></span>
            <span class="links"><a id="linktimed" href="timed.html" class="aNav">TIMED</a></span>
        </nav>

        <main align="center">
            <video id="bgvideo" src="images/background.mp4" autoplay loop muted poster="images/backgroundstill.png"></video>
            
            <div style="padding-top: 0.7vh; padding-bottom: 0.9vh; font-size: 3vh;" id="instructions">
                hard mode for the pros!<br>
                enter your guess here:
            </div>

            <input list="brawlers_list" type="text" id="input" style="margin-bottom: 2vh;">
            <button id="guessbutton">></button>

            <div style="padding-bottom: 0.9vh; font-size: 3vh;" id="remaining">
                guesses remaining: <span id="rem_numb">5</span>
            </div>

            <table id="main_table">
                <tr>
                    <td style="opacity:0%;" class="tdtop"></td>
                    <!-- <td align="center" class="tdtop">rarity</td> -->
                    <td align="center" class="tdtop">wallbreak</td>
                    <td align="center" class="tdtop">p11 health</td>
                    <td align="center" class="tdtop">projectiles</td>
                    <td align="center" class="tdtop">year</td>
                </tr>
            </table>  
            
            <div id="keyboardTop" style="background-color: rgba(0, 0, 0, 0); height: 5vh">
                <div id="toggleKeyboard" onclick="toggleKeyboard()" style="position: relative; left: 90vw; background-color: #bee1f8; border-top-left-radius: 3vw; font-size: 4vh">
                    -
                </div>
            </div>
            <div id="keyboard1">
                <div onclick="kbPress('q', false)" class="keyboardKey">Q</div>
                <div onclick="kbPress('w', false)" class="keyboardKey">W</div>
                <div onclick="kbPress('e', false)" class="keyboardKey">E</div>
                <div onclick="kbPress('r', false)" class="keyboardKey">R</div>
                <div onclick="kbPress('t', false)" class="keyboardKey">T</div>
                <div onclick="kbPress('y', false)" class="keyboardKey">Y</div>
                <div onclick="kbPress('u', false)" class="keyboardKey">U</div>
                <div onclick="kbPress('i', false)" class="keyboardKey">I</div>
                <div onclick="kbPress('o', false)" class="keyboardKey">O</div>
                <div onclick="kbPress('p', false)" class="keyboardKey">P</div>
            </div>
            <div id="keyboard2">
                <div onclick="kbPress('a', false)" class="keyboardKey">A</div>
                <div onclick="kbPress('s', false)" class="keyboardKey">S</div>
                <div onclick="kbPress('d', false)" class="keyboardKey">D</div>
                <div onclick="kbPress('f', false)" class="keyboardKey">F</div>
                <div onclick="kbPress('g', false)" class="keyboardKey">G</div>
                <div onclick="kbPress('h', false)" class="keyboardKey">H</div>
                <div onclick="kbPress('j', false)" class="keyboardKey">J</div>
                <div onclick="kbPress('k', false)" class="keyboardKey">K</div>
                <div onclick="kbPress('l', false)" class="keyboardKey">L</div>
            </div>
            <div id="keyboard3">
                <div onclick="kbPress('z', false)" class="keyboardKey">Z</div>
                <div onclick="kbPress('x', false)" class="keyboardKey">X</div>
                <div onclick="kbPress('c', false)" class="keyboardKey">C</div>
                <div onclick="kbPress('v', false)" class="keyboardKey">V</div>
                <div onclick="kbPress('b', false)" class="keyboardKey">B</div>
                <div onclick="kbPress('n', false)" class="keyboardKey">N</div>
                <div onclick="kbPress('m', false)" class="keyboardKey">M</div>
            </div>
            <div id="keyboard4">
                <div onclick="kbPress('&', false)" class="keyboardKey">&</div>
                <div onclick="kbPress('.', false)" class="keyboardKey">.</div>
                <div onclick="kbPress('-', false)" class="keyboardKey">-</div>
                <div onclick="kbPress('8', false)" class="keyboardKey">8</div>
                <div onclick="kbPress(' ', false)" class="keyboardKey" id="keyboardSpace">_</div>
                <div onclick="kbBack(false)" class="keyboardKey" id="keyboardBack"><img src="images/backspace.png" style="width: 6vw; height: auto;"></div>
                <div class="keyboardKey" id="keyboardGuess">></div>
            </div>

            <div style="position: absolute; height: 100vh; width: 100vw; background-color: rgba(0, 0, 0, 0.3); top: 0px;" id="shadow" class="endscreen"> </div>

            <div style="position: absolute; left: 10vw; top: 9.3vh; width: 80vw; height: 64vh;" id="endscreen" class="endscreen">
                <center>

                    <img id="endscreen-img" src="" draggable="false" style="height: 16.6vh; width: auto; margin-top: 10px;"><br>
                    <div id="endscreen-text">the brawler was BIBI!<br>
                        congratulations!</div><br>
                    <img id="streak-img" src="images/streakanim.gif"><span id="streak1">0 </span><span id="streak2">in a row!</span><br>
                    <span id="streak3">best streak: </span><span id="streak4">2</span><br><br>
                    <button onclick="go_back()" id="back"><b><</b> </button><button  id="play-again">PLAY AGAIN</button><br><br>

                    <a href="https://youtube.com/@Krias" target="_blank"><img src="images/youtube.png">/ @Krias</a> <a class="redlink" href="https://youtu.be/Q9dk4gli0yk" target="_blank">  > NEW VIDEO</a><br>
                    <a href="https://twitter.com/@KriasBS" target="_blank"><img src="images/twitter.png">/ @KriasBS</a>

                </center>
            </div>

        </main>
        <script type = "text/javascript" src="data.js"></script>
        <script type = "text/javascript" src="functions.js"></script>
        <script defer>
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);

            var darkmode = localStorage.getItem("darkmode") || urlParams.get('dm') || "0";
            localStorage.setItem("darkmode", darkmode);

            if(darkmode == "1"){
                darkmode = "0";
                tdarkmode();
            }
            var menuHid = false
            if (localStorage.getItem("menuHid") == null) {
                localStorage.setItem("menuHid", false);
            } 
            else if (localStorage.getItem("menuHid") == 'true'){
                document.getElementById("top").style.transition = "0s";
                document.getElementById("logoarr").style.transition = "0s";
                document.getElementById("navmain").style.transition = "0s";
                var x = document.getElementsByClassName("logobutton");
                for(var i = 0; i < x.length; i++){
                        x[i].style.transition = "0s";
                    }
                x = document.getElementsByClassName("links");
                for(var i = 0; i < x.length; i++){
                    x[i].style.transition = "0s";
                }
                localStorage.setItem("menuHid", false);
                hidemenu();
                document.getElementById("top").style.transition = "0.5s all";
                document.getElementById("logoarr").style.transition = "0.5s all";
                document.getElementById("navmain").style.transition = "0.5s all";
                var x = document.getElementsByClassName("logobutton");
                for(var i = 0; i < x.length; i++){
                        x[i].style.transition = "0.5s all";
                    }
                x = document.getElementsByClassName("links");
                for(var i = 0; i < x.length; i++){
                    x[i].style.transition = "0.5s all";
                }
            }

            document.addEventListener('contextmenu', event => event.preventDefault());
            
            window.onresize = function(){checkSize();}
            window.onload = function(){checkSize();}
            checkSize();
            var keyboard = true;


            
            var obj = JSON.parse(localStorage.getItem("currentHardGame"));
            if (localStorage.getItem("currentHardGame") == null) {
                localStorage.setItem("currentHardGame", JSON.stringify({
                    gameStatus: 'unstarted',
                    guesses: 0,
                    gameString: "",
                    currentWinStreak: 0,
                    maxWinStreak: 0,
                    m_brawler : Math.round(Math.random() * 81)
                })
            )} else if (obj.gameStatus != "unstarted" ) {
                var tempobj = {
                    gameStatus: "unstarted", 
                    guesses: 0,
                    gameString: "",
                    currentWinStreak: obj.currentWinStreak,
                    maxWinStreak: obj.maxWinStreak,
                    m_brawler: obj.m_brawler
                };
                
                lastGameArray = obj.gameString.split("|");
                for (var i = 0; i < lastGameArray.length; i++) {
                    document.getElementById("input").value = lastGameArray[i];
                    tempobj = guess(tempobj);
                }
            }

            document.addEventListener("click", function(event) {
                if (event.target && event.target.id ==="play-again"){
                    obj = JSON.parse(localStorage.getItem("currentHardGame"));
                    obj.gameStatus = 'unstarted';
                    obj.guesses = 0;
                    obj.gameString = "";
                    obj.m_brawler = Math.round(Math.random() * 81);
                    localStorage.setItem("currentHardGame", JSON.stringify(obj));
                    location.reload();
                } else if ((event.target && event.target.id ==="guessbutton") || (event.target && event.target.id ==="keyboardGuess")){
                    obj = JSON.parse(localStorage.getItem("currentHardGame"));
                    obj = guess(obj);
                    localStorage.setItem("currentHardGame", JSON.stringify(obj)); 
                }
            });

            document.addEventListener("keypress", function(event) {
                if (event.keyCode == 13) {
                    obj = JSON.parse(localStorage.getItem("currentHardGame"));
                    obj = guess(obj);
                    localStorage.setItem("currentHardGame", JSON.stringify(obj));
            }});

            

            function guess(obj){
                if (obj.gameStatus == 'won' || obj.gameStatus == 'lost') {
                    return obj;
                };
                var guess_text = document.getElementById("input").value.toLowerCase();
                document.getElementById("input").value = "";
                guess_text = autocorrect(guess_text);

                var brawler_nr = 0

                var brawler_nr = 0
                while(guess_text != brawlers[brawler_nr].name){
                    brawler_nr++;
                    if(brawler_nr == Object.keys(brawlers).length){
                        return obj;
                    }     
                }

                var goodGuesses = 0;
                obj.guesses++;
                obj.gameStatus = "started";
                obj.gameString += brawlers[brawler_nr].name + "|";

                var number = document.getElementById("rem_numb");
                number.innerHTML = 5-obj.guesses;
                if(obj.guesses > 2) number.style.color = "orange";
                if(obj.guesses > 3) number.style.color = "red";

                var main_table = document.getElementById("main_table");

                var row = main_table.insertRow(1);
                var cell = row.insertCell(0);
                cell.className = "imageCell"; cell.align = "center";
                cell.innerHTML = "<img src='images/" + brawlers[brawler_nr].name + ".png' class='imgguess' draggable='false'>";
                animateCSS(cell, "flipInX", "0s");

/*  RARITY      var cell = row.insertCell(1); cell.align= "center";
                if(brawlers[brawler_nr].rarity == brawlers[m_brawler].rarity)   {cell.className = "correct"; goodGuesses++; cell.style = "background-image: url(correct.png)";}
                else    {cell.className = "incorrect"; cell.style = "background-image: url(incorrect.png)";}
                animateCSS(cell, "flipInX", "0.2s");    */
                
/*  WALLBREAK  */ var cell = row.insertCell(1); cell.align= "center";
                if(brawlers[brawler_nr].wall == brawlers[obj.m_brawler].wall)   {cell.className = "correct"; goodGuesses++; cell.style = "background-image: url(images/correct.png)";}
                else    {cell.className = "incorrect"; cell.style = "background-image: url(images/incorrect.png)";}
                animateCSS(cell, "flipInX", "0.4s");

/*  HEALTH  */  var cell = row.insertCell(2); cell.align= "center";
                if(brawlers[brawler_nr].health == brawlers[obj.m_brawler].health)   {cell.className = "correct"; goodGuesses++; cell.style = "background-image: url(images/correct.png)";}
                else    {cell.className = "incorrect";}

                if(brawlers[brawler_nr].health > brawlers[obj.m_brawler].health)   cell.style = "background-image: url(images/lower.png)";
                if(brawlers[brawler_nr].health < brawlers[obj.m_brawler].health)    cell.style = "background-image: url(images/higher.png)";
                animateCSS(cell, "flipInX", "0.6s");

/*  PROJECTILES  */ var cell = row.insertCell(3); cell.align= "center";
                if(brawlers[brawler_nr].projectiles == brawlers[obj.m_brawler].projectiles)     {cell.className = "correct"; goodGuesses++; cell.style = "background-image: url(images/correct.png)";}
                else    {cell.className = "incorrect";}

                if(brawlers[brawler_nr].projectiles > brawlers[obj.m_brawler].projectiles)   cell.style = "background-image: url(images/lower.png)";
                if(brawlers[brawler_nr].projectiles < brawlers[obj.m_brawler].projectiles)    cell.style = "background-image: url(images/higher.png)";
                animateCSS(cell, "flipInX", "0.8s");
                

/*  YEAR  */    var cell = row.insertCell(4); cell.align= "center";
                if(brawlers[brawler_nr].year == brawlers[obj.m_brawler].year)   {cell.className = "correct"; goodGuesses++; cell.style = "background-image: url(images/correct.png)";}
                else    {cell.className = "incorrect"};

                if(brawlers[brawler_nr].year > brawlers[obj.m_brawler].year)   cell.style = "background-image: url(images/lower.png)";
                if(brawlers[brawler_nr].year < brawlers[obj.m_brawler].year)    cell.style = "background-image: url(images/higher.png)";
                animateCSS(cell, "flipInX", "1s");


                if(goodGuesses == 4)
                obj.m_brawler =  brawler_nr;

                

                if(obj.guesses == 5 && brawler_nr != obj.m_brawler){
                    obj.gameStatus = "lost";
                    obj.currentWinStreak = 0;
                    animate_endscreen(brawlers[obj.m_brawler].name);
                    document.getElementById("endscreen-text").innerHTML = "the correct brawler was " + brawlers[obj.m_brawler].name.toUpperCase() + "<br>better luck next time!";
                    document.getElementById("streak-img").style.display = "none";
                    document.getElementById("streak1").style.display = "none";
                    document.getElementById("streak2").style.display = "none";
                    document.getElementById("streak4").innerHTML = obj.maxWinStreak;
                }
                if(brawler_nr == obj.m_brawler){
                    obj.currentWinStreak ++;
                    obj.maxWinStreak = Math.max(obj.currentWinStreak, obj.maxWinStreak);
                    obj.gameStatus = "won";
                    animate_endscreen(brawlers[obj.m_brawler].name);
                    document.getElementById("endscreen-text").innerHTML = "you guessed " + brawlers[obj.m_brawler].name.toUpperCase() + " correctly<br>congratulations!";
                    document.getElementById("streak1").innerHTML = obj.currentWinStreak +" ";
                    document.getElementById("streak4").innerHTML = obj.maxWinStreak;
                }
                return obj;

            }
            function go_back(){
                var shadow = document.getElementById("shadow");
                var endscreen =  document.getElementById("endscreen");
                shadow.style.display = "none";
                endscreen.style.display = "none";

                var inp = document.getElementById("input");
                inp.style.opacity = "0%";
                inp.style.width = "0px";

                var button = document.getElementById("guessbutton");
                button.id = "play-again";
                button.innerHTML = "PLAY AGAIN";
                button.style = "box-sizing: border-box; height: min(7vw, 4vh)";
                game_finished = true;

                var new_text = document.getElementById("instructions");
                new_text.innerHTML = "brawler guessing game!<br>click here to play again"
            }


           

            
            
        </script>
    </body>
</html>